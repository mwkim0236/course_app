<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>수강신청</title>
  <script>
    async function applyCourse(course) {
      const response = await fetch("/apply", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ course })
      });
      const result = await response.json();

      if (result.status === "success") {
        alert(result.message);
        location.reload();
      } else if (result.status === "full") {
        if (confirm(result.message + "\n재신청 하시겠습니까?")) {
          location.reload();
        }
      } else {
        alert(result.message);
      }
    }
  </script>
</head>
<body>
  <h1>수강신청 페이지</h1>
  <ul>
    {% for course, limit in limits.items() %}
      <li>
        {{ course }} ({{ counts[course] }}/{{ limit }})
        <button onclick="applyCourse('{{ course }}')">신청</button>
      </li>
    {% endfor %}
  </ul>
</body>
</html>
